<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
	<channel>
		<title>Posts on Jockels Dev Blog</title>
		<link>http://localhost:63299/posts/</link>
		<description>Recent content in Posts on Jockels Dev Blog</description>
		<generator>Hugo -- gohugo.io</generator>
		<language>en-us</language>
		<copyright>jockel.me</copyright>
		<lastBuildDate>Fri, 20 Dec 2024 12:06:24 +0100</lastBuildDate>
		<atom:link href="http://localhost:63299/posts/index.xml" rel="self" type="application/rss+xml" />
		
		<item>
			<title>Exploring Web3 Gaming and MMORPGs</title>
			<link>http://localhost:63299/posts/exploring-web3-gaming-mmorpgs/</link>
			<pubDate>Fri, 20 Dec 2024 12:06:24 +0100</pubDate>
			
			<guid>http://localhost:63299/posts/exploring-web3-gaming-mmorpgs/</guid>
			<description><![CDATA[%!s(<nil>)]]></description>
			<content type="html"><![CDATA[<h1 id="exploring-ideas-for-web3-and-mmorpgs-with-world-of-warcraft">Exploring Ideas for Web3 and MMORPGs with World of Warcraft</h1>
<p>Visit <a href="https://github.com/realjockel/wow_web3">WoW Web3 on GitHub</a> for the full codebase and instructions.</p>
<p>Video games have always been about adventure, exploration, and the thrill of achieving something grand. But what if the achievements you earn, the guilds you build, and the worlds you conquer could belong to you, the player, in a more tangible, real-world way? Web3 promises just that, bringing decentralized technology into the gaming realm and letting players truly own their digital experiences. In this post, we’ll dive into how one educational project leverages Web3 concepts inside a World of Warcraft (WoW) emulator environment, opening the door to a new era of player-driven gameplay.</p>
<p>WoW was chosen for this educational project, because there are a lot of emulators to choose from, and it has a rich history and a large community. The goal is to show how Web3 concepts can be integrated into existing game servers, WoW is only one example of how this can be done. The project is not affiliated with Blizzard Entertainment, and it’s purely educational and experimental in nature.</p>
<h2 id="why-web3-matters-for-gaming">Why Web3 Matters for Gaming</h2>
<p>Traditional online games rely on <strong>centralized servers</strong>. The rules, assets, and economies are all controlled by the game developer. While it’s been fun, it’s limiting. Web3 changes this paradigm by leveraging blockchain technology to:</p>
<p>• <strong>Give Ownership Back to Players:</strong> Your character, your gear, and even the in-game currency can be yours to hold, trade, or move between servers without someone else’s permission.</p>
<p>• <strong>Enable Player-Governed Servers:</strong> Imagine entire game servers run like communities where decisions about raids, balance changes, or new maps are voted on by players rather than dictated from above.</p>
<p>• <strong>Open Up New Ways to Play and Earn:</strong> From staking tokens on your favorite server to creating bounties and side-quests that pay out tokens, Web3 lets you invent your own in-game opportunities and business models.</p>
<p>This is not about cash-grabs or corporate monetization — at least, not in this project’s educational take. It’s about experimentation, learning, and showing the world what’s possible when you merge a legendary game like WoW with blockchain technology.</p>
<h2 id="what-this-project-does-differently">What this Project does differently?</h2>
<p>This educational prototype uses AzerothCore (a popular WoW private server framework) and integrates it with a blockchain layer via a Python Flask middleware. Here’s a snapshot of what’s going on:</p>
<p>• <strong>Character NFTs:</strong> Your WoW character becomes a Non-Fungible Token. Level up your Paladin, earn epic loot, and then, if you want, move them to another compatible server or even into another game. Your progress lives on the blockchain, not locked in a single server.</p>
<p>• <strong>In-Game Tokens:</strong> Instead of gold controlled by a central database, you have blockchain-based tokens. Want to place a bounty on a rival player’s head? Now you can do it with tokens that have real-world value.</p>
<p>• <strong>DAOs for Guilds:</strong> Guilds can operate as DAOs (Decentralized Autonomous Organizations). Stake tokens for voting power, propose new rules for your guild, or even decide which areas of the map your guild wants to govern and profit from.</p>
<p>• <strong>Map Ownership and Taxes:</strong> Why should map ownership and land rights be limited to the real world? Own a map in-game, earn taxes from players entering your land, and watch a whole new strategic layer of gameplay unfold.</p>
<h2 id="architecture-in-a-nutshell">Architecture in a Nutshell</h2>
<p>• <strong>WoW Server (AzerothCore):</strong> Runs the actual game logic. Your character moves, fights, and explores here.</p>
<p>• <strong>Middleware (Flask Python App):</strong> Bridges the WoW server and the blockchain. When you do something that involves tokens or NFTs, the WoW server sends a request here.</p>
<p>• <strong>Blockchain (Smart Contracts on Ethereum):</strong> Maintains the tokens, character NFTs, guild DAO governance, and other decentralized aspects. Everything is recorded on-chain for transparency and permanence.</p>
<p>• <strong>MySQL Database:</strong> Stores traditional game data and acts as a quick reference layer for the WoW server.</p>
<p>At a high level, the WoW server says, “Player just earned a legendary sword! Let’s mint them some tokens.” The middleware takes care of the blockchain transaction, and the blockchain confirms that yes, you now hold those tokens tied to your character NFT.</p>
<pre tabindex="0"><code>+-------------------+          +-------------------+          +-------------------+
|                   |          |                   |          |                   |
|  WoW Game Client  | &lt;------&gt; |     WoW Server    | &lt;------&gt; | Middleware Server |
|                   |          | (AzerothCore)     |          |   (Flask Server)  |
|                   |          |                   |          |                   |
+-------------------+          +-------------------+          +-------------------+
        ^                             ^                             ^
        |                             |                             |
        |                             |                             |
        v                             v                             v
+-------------------+          +-------------------+          +-------------------+
|                   |          |                   |          |                   |
|      Player       |          |       MySQL       |          |    Blockchain     |
|                   |          |     Database      |          | (Ethereum Network)|
|                   |          |                   |          |                   |
+-------------------+          +-------------------+          +-------------------+
</code></pre><p><strong>AzerothCore + Eluna + Lua Scripts:</strong>
AzerothCore is a C++ WoW server emulator. Eluna is a Lua engine that can be embedded in AzerothCore, allowing us to hook into server events easily. For instance:</p>
<p>• Every time a player earns gold, the Lua script triggers a function call to the middleware server.</p>
<p>• Every time a player spends gold or completes a quest, the script again calls the middleware.</p>
<p>Following lua scripts handles listening to events related to <strong>moneyChange</strong> and calculates the amount of tokens to be minted and taxes to be paid to the map owner:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">json</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;json&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">http_utils</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s2">&#34;http_utils&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">PLAYER_EVENT_ON_MONEY_CHANGE</span> <span class="o">=</span> <span class="mi">14</span>  <span class="c1">-- Assuming event ID 14 is for money change</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">playerGold</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1">-- Table to keep track of each player&#39;s gold amount</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">TAX_RATE</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1">-- 5% tax rate, should match the contract&#39;s TAX_RATE</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">TOKEN_DECIMALS</span> <span class="o">=</span> <span class="mi">1000000000000000000</span>  <span class="c1">-- 10^18, for 18 decimal places</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="n">COPPER_TO_TOKEN_FACTOR</span> <span class="o">=</span> <span class="n">TOKEN_DECIMALS</span> <span class="o">/</span> <span class="mi">10000</span>  <span class="c1">-- Adjusted to handle copper units</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- Add these utility functions at the top</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="kr">function</span> <span class="nf">stringToNumber</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">-- Remove scientific notation</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">num</span> <span class="o">=</span> <span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;%.0f&#34;</span><span class="p">,</span> <span class="n">tonumber</span><span class="p">(</span><span class="n">str</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="kr">return</span> <span class="n">tonumber</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- Convert tokens (with 18 decimals) to WoW copper</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="kr">function</span> <span class="nf">tokensToCopper</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kr">if</span> <span class="n">type</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&#34;string&#34;</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">        <span class="n">tokens</span> <span class="o">=</span> <span class="n">stringToNumber</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kr">end</span>
</span></span><span class="line"><span class="cl">    <span class="c1">-- 1 copper = 10^14 token units (since tokens have 18 decimals and we want 4 decimals for copper)</span>
</span></span><span class="line"><span class="cl">    <span class="kr">return</span> <span class="n">math.floor</span><span class="p">(</span><span class="n">tokens</span> <span class="o">/</span> <span class="n">COPPER_TO_TOKEN_FACTOR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- Convert WoW copper to tokens (with 18 decimals)</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="kr">function</span> <span class="nf">copperToTokens</span><span class="p">(</span><span class="n">copper</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">-- Ensure copper is an integer</span>
</span></span><span class="line"><span class="cl">    <span class="n">copper</span> <span class="o">=</span> <span class="n">math.floor</span><span class="p">(</span><span class="n">copper</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">-- Convert to token units (multiply by 10^14)</span>
</span></span><span class="line"><span class="cl">    <span class="kr">return</span> <span class="n">copper</span> <span class="o">*</span> <span class="n">COPPER_TO_TOKEN_FACTOR</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- Function to make RPC request to Flask server</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="kr">function</span> <span class="nf">rpcRequest</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">jsonData</span> <span class="o">=</span> <span class="n">json.encode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">response</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">http_utils.httpRequest</span><span class="p">(</span><span class="s2">&#34;POST&#34;</span><span class="p">,</span> <span class="n">jsonData</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kr">if</span> <span class="n">err</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span><span class="p">(</span><span class="s2">&#34;Error: &#34;</span> <span class="o">..</span> <span class="n">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kr">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">err</span>
</span></span><span class="line"><span class="cl">    <span class="kr">elseif</span> <span class="n">response</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">        <span class="kr">if</span> <span class="n">response.success</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">            <span class="n">print</span><span class="p">(</span><span class="s2">&#34;Transaction successful. Hash: &#34;</span> <span class="o">..</span> <span class="p">(</span><span class="n">response.transaction_hash</span> <span class="ow">or</span> <span class="s2">&#34;&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="kr">return</span> <span class="n">response</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">        <span class="kr">else</span>
</span></span><span class="line"><span class="cl">            <span class="n">print</span><span class="p">(</span><span class="s2">&#34;Error: &#34;</span> <span class="o">..</span> <span class="p">(</span><span class="n">response.error</span> <span class="ow">or</span> <span class="s2">&#34;Unknown error&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="kr">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">response.error</span>
</span></span><span class="line"><span class="cl">        <span class="kr">end</span>
</span></span><span class="line"><span class="cl">    <span class="kr">else</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span><span class="p">(</span><span class="s2">&#34;No response received&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kr">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="s2">&#34;No response&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="kr">end</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- Function to get player&#39;s token balance</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="kr">function</span> <span class="nf">getTokenBalance</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">url</span> <span class="o">=</span> <span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;http://localhost:3000/balance?address=%s&#34;</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">response</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">http_utils.httpRequest</span><span class="p">(</span><span class="s2">&#34;GET&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kr">if</span> <span class="n">err</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span><span class="p">(</span><span class="s2">&#34;Error getting balance: &#34;</span> <span class="o">..</span> <span class="n">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kr">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="kr">elseif</span> <span class="n">response</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">        <span class="kr">if</span> <span class="n">response.success</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">            <span class="kr">return</span> <span class="n">tonumber</span><span class="p">(</span><span class="n">response.balance</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="kr">else</span>
</span></span><span class="line"><span class="cl">            <span class="n">print</span><span class="p">(</span><span class="s2">&#34;Error getting balance: &#34;</span> <span class="o">..</span> <span class="p">(</span><span class="n">response.error</span> <span class="ow">or</span> <span class="s2">&#34;Unknown error&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="kr">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="kr">end</span>
</span></span><span class="line"><span class="cl">    <span class="kr">else</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span><span class="p">(</span><span class="s2">&#34;No response received when getting balance&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kr">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="kr">end</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- Function to get map owner</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="kr">function</span> <span class="nf">getMapOwner</span><span class="p">(</span><span class="n">mapId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">url</span> <span class="o">=</span> <span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;http://localhost:3000/get_map_owner?mapId=%s&#34;</span><span class="p">,</span> <span class="n">mapId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">response</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">http_utils.httpRequest</span><span class="p">(</span><span class="s2">&#34;GET&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kr">if</span> <span class="n">err</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span><span class="p">(</span><span class="s2">&#34;Error getting map owner: &#34;</span> <span class="o">..</span> <span class="n">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kr">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">    <span class="kr">elseif</span> <span class="n">response</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">        <span class="kr">if</span> <span class="n">response.success</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">            <span class="kr">return</span> <span class="n">response.owner</span>
</span></span><span class="line"><span class="cl">        <span class="kr">else</span>
</span></span><span class="line"><span class="cl">            <span class="n">print</span><span class="p">(</span><span class="s2">&#34;Error getting map owner: &#34;</span> <span class="o">..</span> <span class="p">(</span><span class="n">response.error</span> <span class="ow">or</span> <span class="s2">&#34;Unknown error&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="kr">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">        <span class="kr">end</span>
</span></span><span class="line"><span class="cl">    <span class="kr">else</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span><span class="p">(</span><span class="s2">&#34;No response received when getting map owner&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kr">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">    <span class="kr">end</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- Add these helper functions at the top with other utility functions</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="kr">function</span> <span class="nf">copperToGoldStr</span><span class="p">(</span><span class="n">copper</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">gold</span> <span class="o">=</span> <span class="n">math.floor</span><span class="p">(</span><span class="n">copper</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">silver</span> <span class="o">=</span> <span class="n">math.floor</span><span class="p">((</span><span class="n">copper</span> <span class="o">%</span> <span class="mi">10000</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">copper</span> <span class="o">=</span> <span class="n">copper</span> <span class="o">%</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl">    <span class="kr">return</span> <span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;%dg %ds %dc&#34;</span><span class="p">,</span> <span class="n">gold</span><span class="p">,</span> <span class="n">silver</span><span class="p">,</span> <span class="n">copper</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- Function to handle the gold change event</span>
</span></span><span class="line"><span class="cl"><span class="kd">local</span> <span class="kr">function</span> <span class="nf">OnGoldChange</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">player</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kr">if</span> <span class="ow">not</span> <span class="n">player</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">amount</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">        <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Error: Player or amount is nil&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kr">return</span>
</span></span><span class="line"><span class="cl">    <span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">playerGUID</span> <span class="o">=</span> <span class="n">player</span><span class="p">:</span><span class="n">GetGUIDLow</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">oldGold</span> <span class="o">=</span> <span class="n">player</span><span class="p">:</span><span class="n">GetCoinage</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">goldDifference</span> <span class="o">=</span> <span class="n">amount</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">newGold</span> <span class="o">=</span> <span class="n">oldGold</span> <span class="o">+</span> <span class="n">amount</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">playerAddress</span> <span class="o">=</span> <span class="s2">&#34;0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266&#34;</span>  <span class="c1">-- Player&#39;s Ethereum address</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">playerAddress</span> <span class="o">=</span> <span class="s2">&#34;0x70997970C51812dc3A010C7d01b50e0d17dc79C8&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">currentTokenBalance</span> <span class="o">=</span> <span class="n">stringToNumber</span><span class="p">(</span><span class="n">getTokenBalance</span><span class="p">(</span><span class="n">playerAddress</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">mapOwner</span> <span class="o">=</span> <span class="n">getMapOwner</span><span class="p">(</span><span class="n">player</span><span class="p">:</span><span class="n">GetAreaId</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">taxAmount</span> <span class="o">=</span> <span class="n">math.floor</span><span class="p">(</span><span class="n">goldDifference</span> <span class="o">*</span> <span class="n">TAX_RATE</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Old Money: &#34;</span> <span class="o">..</span> <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">oldGold</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;New Money: &#34;</span> <span class="o">..</span> <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">newGold</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Money Difference: &#34;</span> <span class="o">..</span> <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">goldDifference</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Current Token Balance: &#34;</span> <span class="o">..</span> <span class="n">currentTokenBalance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Map Owner: &#34;</span> <span class="o">..</span> <span class="n">tostring</span><span class="p">(</span><span class="n">mapOwner</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">if</span> <span class="n">goldDifference</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">        <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;No change in money amount.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kr">return</span>
</span></span><span class="line"><span class="cl">    <span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">flask_url</span> <span class="o">=</span> <span class="s2">&#34;http://localhost:3000&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">mapId</span> <span class="o">=</span> <span class="n">player</span><span class="p">:</span><span class="n">GetAreaId</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">local</span> <span class="n">currentGold</span> <span class="o">=</span> <span class="n">tokensToCopper</span><span class="p">(</span><span class="n">currentTokenBalance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kr">if</span> <span class="n">oldGold</span> <span class="o">~=</span> <span class="n">currentGold</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">        <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Money and token balance do not match. Adjusting...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Current Token Balance: &#34;</span> <span class="o">..</span> <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">currentGold</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Old Money: &#34;</span> <span class="o">..</span> <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">oldGold</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">player</span><span class="p">:</span><span class="n">SetCoinage</span><span class="p">(</span><span class="n">currentGold</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Money adjusted to match token balance: &#34;</span> <span class="o">..</span> <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">currentGold</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">if</span> <span class="n">goldDifference</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">        <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Minting tokens...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">local</span> <span class="n">tokenAmount</span> <span class="o">=</span> <span class="n">copperToTokens</span><span class="p">(</span><span class="n">goldDifference</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">local</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">to</span> <span class="o">=</span> <span class="n">playerAddress</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">amount</span> <span class="o">=</span> <span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;%.0f&#34;</span><span class="p">,</span> <span class="n">tokenAmount</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">mapId</span> <span class="o">=</span> <span class="n">tostring</span><span class="p">(</span><span class="n">mapId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kd">local</span> <span class="n">result</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">rpcRequest</span><span class="p">(</span><span class="n">flask_url</span> <span class="o">..</span> <span class="s2">&#34;/mint&#34;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kr">if</span> <span class="n">result</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">            <span class="kd">local</span> <span class="n">netAmount</span> <span class="o">=</span> <span class="n">goldDifference</span> <span class="o">-</span> <span class="n">taxAmount</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Gross Amount: &#34;</span> <span class="o">..</span> <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">goldDifference</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Tax Amount: &#34;</span> <span class="o">..</span> <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">taxAmount</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Net Amount: &#34;</span> <span class="o">..</span> <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">netAmount</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="kd">local</span> <span class="n">expectedTokenBalance</span> <span class="o">=</span> <span class="n">currentTokenBalance</span> <span class="o">+</span> <span class="n">copperToTokens</span><span class="p">(</span><span class="n">netAmount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Expected token balance: &#34;</span> <span class="o">..</span> <span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;%.0f&#34;</span><span class="p">,</span> <span class="n">expectedTokenBalance</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="kd">local</span> <span class="n">newTokenBalance</span> <span class="o">=</span> <span class="n">stringToNumber</span><span class="p">(</span><span class="n">getTokenBalance</span><span class="p">(</span><span class="n">playerAddress</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Actual token balance: &#34;</span> <span class="o">..</span> <span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;%.0f&#34;</span><span class="p">,</span> <span class="n">newTokenBalance</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="kd">local</span> <span class="n">expectedCopper</span> <span class="o">=</span> <span class="n">tokensToCopper</span><span class="p">(</span><span class="n">expectedTokenBalance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="kd">local</span> <span class="n">actualCopper</span> <span class="o">=</span> <span class="n">tokensToCopper</span><span class="p">(</span><span class="n">newTokenBalance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="kr">if</span> <span class="n">expectedCopper</span> <span class="o">~=</span> <span class="n">actualCopper</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">                <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Warning: Money balance mismatch. Expected: &#34;</span> <span class="o">..</span> <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">expectedCopper</span><span class="p">)</span> <span class="o">..</span> 
</span></span><span class="line"><span class="cl">                      <span class="s2">&#34;, Actual: &#34;</span> <span class="o">..</span> <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">actualCopper</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="kr">end</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SetCoinage</span><span class="p">(</span><span class="n">actualCopper</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Adjusted money after tax: &#34;</span> <span class="o">..</span> <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">actualCopper</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;You gained %s. Tax paid: %s.&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">netAmount</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">                <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">taxAmount</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;Map Owner: %s&#34;</span><span class="p">,</span> <span class="n">mapOwner</span> <span class="ow">or</span> <span class="s2">&#34;None&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="kr">else</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SetCoinage</span><span class="p">(</span><span class="n">currentGold</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Minting failed, money change reverted&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Failed to process money gain. Please contact an administrator.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kr">end</span>
</span></span><span class="line"><span class="cl">    <span class="kr">elseif</span> <span class="n">goldDifference</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">        <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Burning tokens...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">local</span> <span class="n">burnAmount</span> <span class="o">=</span> <span class="n">math.abs</span><span class="p">(</span><span class="n">goldDifference</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kd">local</span> <span class="n">tokenBurnAmount</span> <span class="o">=</span> <span class="n">copperToTokens</span><span class="p">(</span><span class="n">burnAmount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="kr">if</span> <span class="n">currentTokenBalance</span> <span class="o">&lt;</span> <span class="n">tokenBurnAmount</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Insufficient token balance. Cannot burn tokens.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SetCoinage</span><span class="p">(</span><span class="n">currentGold</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Money adjusted to match token balance: &#34;</span> <span class="o">..</span> <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">currentGold</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="kr">return</span>
</span></span><span class="line"><span class="cl">        <span class="kr">end</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="kd">local</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">from</span> <span class="o">=</span> <span class="n">playerAddress</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">amount</span> <span class="o">=</span> <span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;%.0f&#34;</span><span class="p">,</span> <span class="n">tokenBurnAmount</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">mapId</span> <span class="o">=</span> <span class="n">tostring</span><span class="p">(</span><span class="n">mapId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kd">local</span> <span class="n">result</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">rpcRequest</span><span class="p">(</span><span class="n">flask_url</span> <span class="o">..</span> <span class="s2">&#34;/burn&#34;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kr">if</span> <span class="n">result</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">            <span class="kd">local</span> <span class="n">newTokenBalance</span> <span class="o">=</span> <span class="n">stringToNumber</span><span class="p">(</span><span class="n">getTokenBalance</span><span class="p">(</span><span class="n">playerAddress</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="kd">local</span> <span class="n">newCopper</span> <span class="o">=</span> <span class="n">tokensToCopper</span><span class="p">(</span><span class="n">newTokenBalance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SetCoinage</span><span class="p">(</span><span class="n">newCopper</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Adjusted money after burning: &#34;</span> <span class="o">..</span> <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">newCopper</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="n">string.format</span><span class="p">(</span><span class="s2">&#34;You lost %s.&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">burnAmount</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="kr">else</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SetCoinage</span><span class="p">(</span><span class="n">currentGold</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Burning failed, money change reverted&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Failed to process money loss. Please contact an administrator.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="kr">end</span>
</span></span><span class="line"><span class="cl">    <span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">playerGold</span><span class="p">[</span><span class="n">playerGUID</span><span class="p">]</span> <span class="o">=</span> <span class="n">player</span><span class="p">:</span><span class="n">GetCoinage</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Current Money: &#34;</span> <span class="o">..</span> <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">player</span><span class="p">:</span><span class="n">GetCoinage</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">    <span class="n">player</span><span class="p">:</span><span class="n">SetCoinage</span><span class="p">(</span><span class="n">player</span><span class="p">:</span><span class="n">GetCoinage</span><span class="p">()</span> <span class="o">-</span> <span class="p">(</span><span class="n">goldDifference</span> <span class="o">+</span> <span class="n">taxAmount</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">player</span><span class="p">:</span><span class="n">SendBroadcastMessage</span><span class="p">(</span><span class="s2">&#34;Current Money after change: &#34;</span> <span class="o">..</span> <span class="n">copperToGoldStr</span><span class="p">(</span><span class="n">player</span><span class="p">:</span><span class="n">GetCoinage</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- Register the event handler for when a player&#39;s gold amount changes</span>
</span></span><span class="line"><span class="cl"><span class="n">RegisterPlayerEvent</span><span class="p">(</span><span class="n">PLAYER_EVENT_ON_MONEY_CHANGE</span><span class="p">,</span> <span class="n">OnGoldChange</span><span class="p">)</span>
</span></span></code></pre></div><p><strong>The Middleware Server (Flask/Python):</strong>
The middleware receives HTTP requests from the WoW server scripts. Each request might say:</p>
<p>“Player X earned 100 gold. Mint 100 tokens to Player X’s blockchain address.”</p>
<p>or</p>
<p>“Player Y spent 50 gold at the auction house. Burn 50 tokens from Player Y’s address.”</p>
<p>The middleware then constructs and signs blockchain transactions. It may batch multiple requests together and submit them at intervals.</p>
<p>The following code shows how the middleware sends a transaction related to map_ownerhsip to the blockchain:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/purchase_map&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">purchase_map</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">map_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mapId&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">buyer_address</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;buyer&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">contract</span> <span class="o">=</span> <span class="n">w3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">contract_address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">wowToken_abi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">transaction</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">purchaseMap</span><span class="p">(</span><span class="n">map_id</span><span class="p">)</span><span class="o">.</span><span class="n">build_transaction</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="n">buyer_address</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;nonce&#39;</span><span class="p">:</span> <span class="n">w3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">get_transaction_count</span><span class="p">(</span><span class="n">buyer_address</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;gas&#39;</span><span class="p">:</span> <span class="mi">300000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;gasPrice&#39;</span><span class="p">:</span> <span class="n">w3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">gas_price</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">signed_txn</span> <span class="o">=</span> <span class="n">w3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">sign_transaction</span><span class="p">(</span><span class="n">transaction</span><span class="p">,</span> <span class="n">private_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">tx_hash</span> <span class="o">=</span> <span class="n">w3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">send_raw_transaction</span><span class="p">(</span><span class="n">signed_txn</span><span class="o">.</span><span class="n">raw_transaction</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">tx_receipt</span> <span class="o">=</span> <span class="n">w3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">wait_for_transaction_receipt</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">tx_receipt</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;transaction_hash&#39;</span><span class="p">:</span> <span class="n">tx_hash</span><span class="o">.</span><span class="n">hex</span><span class="p">()}),</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Transaction failed&#39;</span><span class="p">}),</span> <span class="mi">400</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}),</span> <span class="mi">500</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/get_map_owner&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_map_owner</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">map_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mapId&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">contract</span> <span class="o">=</span> <span class="n">w3</span><span class="o">.</span><span class="n">eth</span><span class="o">.</span><span class="n">contract</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">contract_address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">wowToken_abi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">owner</span> <span class="o">=</span> <span class="n">contract</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">getMapOwner</span><span class="p">(</span><span class="n">map_id</span><span class="p">)</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;owner&#39;</span><span class="p">:</span> <span class="n">owner</span><span class="p">}),</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}),</span> <span class="mi">500</span>
</span></span></code></pre></div><p><strong>On the Blockchain Side (Solidity Contracts):</strong></p>
<p>Smart contracts store character NFTs, track token balances, handle staking logic for servers, and govern map ownership. DAO contracts allow proposals for adding or removing servers, adjusting rules, or executing slashing conditions.</p>
<p>Following example shows a smart contract that handles token minting and burning as well as map ownership:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="c1">// SPDX-License-Identifier: UNLICENSED
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">pragma solidity</span> <span class="o">^</span><span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">13</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;@openzeppelin/contracts/token/ERC20/extensions/ERC20Votes.sol&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;@openzeppelin/contracts/access/Ownable.sol&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">contract</span> <span class="nc">WowToken</span> <span class="k">is</span> <span class="n">ERC20Votes</span><span class="p">,</span> <span class="n">Ownable</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint256</span> <span class="k">public</span> <span class="k">constant</span> <span class="n">TAX_RATE</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// 5% tax
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint256</span> <span class="k">public</span> <span class="k">constant</span> <span class="n">OWNERSHIP_DURATION</span> <span class="o">=</span> <span class="mi">1</span> <span class="kc">days</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">struct</span> <span class="nc">MapOwnership</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">address</span> <span class="n">owner</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint256</span> <span class="n">expirationTime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">mapping</span><span class="p">(</span><span class="kt">uint256</span> <span class="o">=&gt;</span> <span class="n">MapOwnership</span><span class="p">)</span> <span class="k">public</span> <span class="n">mapOwners</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">event</span> <span class="nc">MapPurchased</span><span class="p">(</span><span class="kt">uint256</span> <span class="k">indexed</span> <span class="n">mapId</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">newOwner</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">event</span> <span class="nc">TaxPaid</span><span class="p">(</span><span class="kt">uint256</span> <span class="k">indexed</span> <span class="n">mapId</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">mapOwner</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">constructor</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl">        <span class="n">ERC20</span><span class="p">(</span><span class="s">&#34;WowToken&#34;</span><span class="p">,</span> <span class="s">&#34;WOW&#34;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">        <span class="n">ERC20Permit</span><span class="p">(</span><span class="s">&#34;WowToken&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">Ownable</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">_mint</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">,</span> <span class="mi">1000000</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">decimals</span><span class="p">());</span> <span class="c1">// Mint initial supply to deployer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">mint</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">public</span> <span class="n">onlyOwner</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">_mintInternal</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">mint</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">mapId</span><span class="p">)</span> <span class="k">public</span> <span class="n">onlyOwner</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">_mintInternal</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">mapId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">_mintInternal</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">mapId</span><span class="p">)</span> <span class="k">private</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint256</span> <span class="n">taxAmount</span> <span class="o">=</span> <span class="p">(</span><span class="n">amount</span> <span class="o">*</span> <span class="n">TAX_RATE</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint256</span> <span class="n">netAmount</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">-</span> <span class="n">taxAmount</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">_mint</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">netAmount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">mapId</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">mapOwners</span><span class="p">[</span><span class="n">mapId</span><span class="p">].</span><span class="n">owner</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">mapOwners</span><span class="p">[</span><span class="n">mapId</span><span class="p">].</span><span class="n">expirationTime</span> <span class="o">&gt;</span> <span class="nb">block</span><span class="p">.</span><span class="nb">timestamp</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">_mint</span><span class="p">(</span><span class="n">mapOwners</span><span class="p">[</span><span class="n">mapId</span><span class="p">].</span><span class="n">owner</span><span class="p">,</span> <span class="n">taxAmount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">emit</span> <span class="n">TaxPaid</span><span class="p">(</span><span class="n">mapId</span><span class="p">,</span> <span class="n">mapOwners</span><span class="p">[</span><span class="n">mapId</span><span class="p">].</span><span class="n">owner</span><span class="p">,</span> <span class="n">taxAmount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">_mint</span><span class="p">(</span><span class="n">owner</span><span class="p">(),</span> <span class="n">taxAmount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">burn</span><span class="p">(</span><span class="kt">address</span> <span class="k">from</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">)</span> <span class="k">external</span> <span class="n">onlyOwner</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">_burnInternal</span><span class="p">(</span><span class="k">from</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">burn</span><span class="p">(</span><span class="kt">address</span> <span class="k">from</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">mapId</span><span class="p">)</span> <span class="k">external</span> <span class="n">onlyOwner</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">_burnInternal</span><span class="p">(</span><span class="k">from</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">mapId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">_burnInternal</span><span class="p">(</span><span class="kt">address</span> <span class="k">from</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">mapId</span><span class="p">)</span> <span class="k">private</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint256</span> <span class="n">taxAmount</span> <span class="o">=</span> <span class="p">(</span><span class="n">amount</span> <span class="o">*</span> <span class="n">TAX_RATE</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint256</span> <span class="n">netAmount</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">-</span> <span class="n">taxAmount</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">_burn</span><span class="p">(</span><span class="k">from</span><span class="p">,</span> <span class="n">netAmount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">mapId</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">mapOwners</span><span class="p">[</span><span class="n">mapId</span><span class="p">].</span><span class="n">owner</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">mapOwners</span><span class="p">[</span><span class="n">mapId</span><span class="p">].</span><span class="n">expirationTime</span> <span class="o">&gt;</span> <span class="nb">block</span><span class="p">.</span><span class="nb">timestamp</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">_mint</span><span class="p">(</span><span class="n">mapOwners</span><span class="p">[</span><span class="n">mapId</span><span class="p">].</span><span class="n">owner</span><span class="p">,</span> <span class="n">taxAmount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">emit</span> <span class="n">TaxPaid</span><span class="p">(</span><span class="n">mapId</span><span class="p">,</span> <span class="n">mapOwners</span><span class="p">[</span><span class="n">mapId</span><span class="p">].</span><span class="n">owner</span><span class="p">,</span> <span class="n">taxAmount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">_mint</span><span class="p">(</span><span class="n">owner</span><span class="p">(),</span> <span class="n">taxAmount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">purchaseMap</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">mapId</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">require</span><span class="p">(</span><span class="n">balanceOf</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10000</span><span class="p">,</span> <span class="s">&#34;Insufficient balance to purchase map&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nb">require</span><span class="p">(</span><span class="n">mapOwners</span><span class="p">[</span><span class="n">mapId</span><span class="p">].</span><span class="n">expirationTime</span> <span class="o">&lt;</span> <span class="nb">block</span><span class="p">.</span><span class="nb">timestamp</span><span class="p">,</span> <span class="s">&#34;Map is already owned&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">_burn</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">,</span> <span class="mi">10000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mapOwners</span><span class="p">[</span><span class="n">mapId</span><span class="p">]</span> <span class="o">=</span> <span class="n">MapOwnership</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">,</span> <span class="nb">block</span><span class="p">.</span><span class="nb">timestamp</span> <span class="o">+</span> <span class="n">OWNERSHIP_DURATION</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">emit</span> <span class="n">MapPurchased</span><span class="p">(</span><span class="n">mapId</span><span class="p">,</span> <span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">getMapOwner</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">mapId</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">mapOwners</span><span class="p">[</span><span class="n">mapId</span><span class="p">].</span><span class="n">expirationTime</span> <span class="o">&gt;</span> <span class="nb">block</span><span class="p">.</span><span class="nb">timestamp</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">mapOwners</span><span class="p">[</span><span class="n">mapId</span><span class="p">].</span><span class="n">owner</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// The following functions are overrides required by Solidity.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">_afterTokenTransfer</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="kt">address</span> <span class="k">from</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="kt">address</span> <span class="n">to</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint256</span> <span class="n">amount</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="k">internal</span> <span class="k">virtual</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">.</span><span class="n">_afterTokenTransfer</span><span class="p">(</span><span class="k">from</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">_mint</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="kt">address</span> <span class="n">to</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint256</span> <span class="n">amount</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="k">internal</span> <span class="k">virtual</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">.</span><span class="n">_mint</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">_burn</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="kt">address</span> <span class="n">account</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint256</span> <span class="n">amount</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="k">internal</span> <span class="k">virtual</span> <span class="k">override</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">.</span><span class="n">_burn</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><strong>Data Flow Example:</strong></p>
<ol>
<li>
<p>Player completes a quest. WoW server (via Eluna) calls a Lua function that triggers an HTTP request to the Flask middleware.</p>
</li>
<li>
<p>The middleware records this event and (if batching) waits until the next batch interval.</p>
</li>
<li>
<p>After batching enough events, the middleware sends a single Ethereum transaction to the token contract to update balances.</p>
</li>
<li>
<p>The token contract updates ledgers, potentially updates DAOs if governance tokens are involved, and emits events that could be consumed by analytics dashboards.</p>
</li>
</ol>
<h2 id="scaling-up-appchains-and-the-future"><strong>Scaling Up: Appchains and the Future</strong></h2>
<p>Of course, running game logic on a global blockchain can face challenges. Transaction throughput, gas fees, and network congestion are real concerns. That’s where appchains—customized blockchains dedicated entirely to your game—could come in. Appchains let you:</p>
<p>• Scale up transactions, so it never feels laggy or expensive.</p>
<p>• Customize rules and governance models for your unique game community.</p>
<p>• Build seamless bridges to other games, creating a future ecosystem of interconnected gaming worlds.</p>
<p>This educational projects was tested on a local chain based on <strong>anvil</strong>, which emulates an EVM chain. It supports mining blocks on demand.</p>
<h2 id="caveats-and-considerations"><strong>Caveats and Considerations</strong></h2>
<p>This is experimental, only a prototype and educational. There are security concerns (what if someone tries to exploit the blockchain connection?), issues with scalability (can we handle thousands of transactions per second?), and the big question of user experience (do non-crypto gamers want to manage keys and wallets?). These challenges aren’t trivial, but they’re solvable.</p>
<p><strong>1. Server Authority and Governance</strong></p>
<p><strong>The Challenge:</strong></p>
<p>In this model, the game server itself is responsible for interacting with the blockchain. Instead of each player having a wallet that directly submits transactions, the server acts as a centralized intermediary, issuing tokens, minting NFTs, or updating player states on-chain. That’s convenient for integrating an existing client like WoW—which can’t natively sign transactions—but it raises significant trust and governance issues.</p>
<p><strong>Why Governance Is Critical:</strong></p>
<p>If the server is the sole entity sending transactions, we must ask: <strong>Who runs this server, and why should we trust them?</strong> If a malicious server operator tampers with gameplay data—like claiming that a character earned tokens they didn’t, or didn’t pay taxes they did—how do we hold them accountable?</p>
<p><strong>DAO-Driven Approvals:</strong></p>
<p>One approach is to have each server registered and approved by a DAO (Decentralized Autonomous Organization). The DAO membership could be composed of players, guild representatives, or community members who vote on which servers are allowed to write to the game’s smart contracts. This ensures no single party can just spin up a rogue server and start minting unearned tokens.</p>
<p><strong>Staking for Accountability:</strong></p>
<p>Servers might have to post a “stake” in tokens to gain write-access to the blockchain contracts. If a server is caught submitting invalid data, their stake can be slashed (partially or wholly confiscated). This creates an economic incentive to play by the rules.</p>
<p><strong>2. Validating Authenticity of Server Data</strong></p>
<p><strong>Proofs of Authentic Gameplay:</strong></p>
<p>We need a way to ensure that the server is running an unmodified version of AzerothCore (the WoW emulator) and not injecting false events. Potential approaches could include using cryptographic attestation, or periodic proofs submitted by the server operator showing they haven’t altered the code.</p>
<p>For example, the server could provide a cryptographic hash of the AzerothCore binaries it’s running, signed by a key known to the DAO. Any deviation from the default version might invalidate the server’s right to issue transactions. Over time, more sophisticated proof systems (like zk-SNARKs) could be integrated to verify that game state transitions are correct without revealing sensitive data.</p>
<p><strong>3. Punishments (Slashing)</strong></p>
<p><strong>Slashing Conditions:</strong></p>
<p>When a server posts incorrect data—like awarding tokens for gold that was never earned, or failing to subtract tokens when a player spends gold—the on-chain logic could trigger a slash. The server’s staked tokens are reduced, compensating victims or just burning the stake to deter misbehavior.</p>
<p><strong>Enforcement Mechanism:</strong></p>
<p>If the DAO receives proofs of cheating (for example, a player or third-party validator submits evidence that the server state and the on-chain state diverge), a proposal can be created to slash the server’s stake. This creates a strong economic deterrent against fraudulent reporting.</p>
<p><strong>4. Transaction Volume and Scalability</strong></p>
<p><strong>Triggering a Transaction on Every Monetary Change:</strong></p>
<p>Right now, the simplest approach is to hook into every money change event in the WoW server logic (via Eluna, the Lua engine that allows scripting AzerothCore) and trigger a corresponding token transfer on-chain. For example, whenever a player receives gold from a quest, the server requests a mint transaction of tokens; whenever they spend gold, the server requests a burn transaction.</p>
<p><strong>Batching Transactions for Performance:</strong></p>
<p>However, sending a blockchain transaction for every single in-game economic event would be costly and slow. A better approach might be to batch these changes. The server could record all gold gains and losses over a short period (e.g., one minute) and then commit them to the blockchain in a single transaction. This reduces gas costs, improves performance, and scales better if we have thousands of players performing microtransactions continuously.</p>
<p><strong>Layer-2 Solutions or Appchains:</strong></p>
<p>As complexity grows, even batching might not be enough. Layer-2 solutions (like rollups) or dedicated gaming appchains could handle massive transaction volumes cheaply and quickly, then periodically settle back to a main blockchain for security.</p>
<p><strong>5. Staking on Servers and Competition</strong></p>
<p><strong>Server Funding via Staking:</strong></p>
<p>Players and communities can stake tokens on their favorite servers. This not only funds server maintenance (possibly paying operators) but also aligns incentives: a well-run server that accurately reports data and provides a great gaming experience will attract more stakers and thereby more capital.</p>
<p><strong>Competition Between Servers:</strong></p>
<p>If multiple servers run the same game but offer different rules, governance models or uptime and performance gurantees, players can vote with their stake by supporting the servers they like. A well-run server with fair governance and consistent updates might attract more stakers and players, while poor-quality or dishonest servers will lose stake and eventually fail.</p>
<p><strong>6. Deeper Use Cases with Smart Contracts</strong></p>
<p><strong>Automated Side Quests and Bounties:</strong></p>
<p>Smart contracts allow for programmable logic. Imagine a “bounty” contract where players can post rewards for certain in-game achievements—like defeating a particular raid boss or a notorious PvP opponent. When the event is logged by the server, the contract automatically pays out the bounty to whoever accomplished the feat.</p>
<p><strong>New Auction House Mechanics:</strong></p>
<p>By extending the auction house into smart contracts, we can create sophisticated financial instruments:</p>
<p>• <strong>Options and Derivatives:</strong> Bet on the future price of rare items. If you think a certain item will be more valuable next week, buy a call option today.</p>
<p>• <strong>Shorting and Lending Items:</strong> Lend your rare sword (NFT) to another player for a fee, or short an item you believe will drop in value.</p>
<p>These mechanics create a player-driven economic ecosystem far richer than what standard game mechanics can offer.</p>
<p><strong>Owning Maps and Zones:</strong></p>
<p>Players or guilds could purchase “ownership” of certain maps or zones as NFTs. Ownership might grant the right to collect taxes, dictate local rules (like PvP toggles), or even spawn unique resources. This transforms the game world into a dynamic real-estate market, where strategic control of territories can become a central part of the meta-game.</p>
<h2 id="the-big-picture"><strong>The Big Picture</strong></h2>
<p>What’s so exciting about all of this is that it breaks down walls. Your character isn’t just some data stuck in a database you’ll lose when the server shuts down. Instead, it’s something you can carry with you—a badge of honor truly owned by you. Guilds are no longer just chat groups; they’re member-owned cooperatives shaping the game world’s future. In-game marketplaces aren’t just for swapping items they’re economies with sophisticated financial instruments.</p>
<p>This project is just the tip of the iceberg, meant to spark your imagination. It’s a hands-on demonstration of how Web3 can add entirely new dimensions to gaming—dimensions that put players in control, foster rich social governance, and create economic layers as complex and creative as the worlds we love to play in.</p>
<p>While the integration of Web3 and a WoW server unlocks incredible potential—truly player-owned characters, dynamic economies, DAO-driven governance—it also introduces complexities and responsibilities. We must carefully design systems to ensure trust, fairness, and performance. Servers need to be governed and held accountable through staking, slashing, and verifiable proofs of authenticity. Transactions should be batched for scalability. The resulting ecosystem, if successful, is a vibrant, player-driven environment where creativity, competition, and collaboration thrive, and where in-game actions can echo into real-world value and community dynamics.</p>
<p>Visit <a href="https://github.com/realjockel/wow_web3">WoW Web3 on GitHub</a> for the full codebase and instructions.</p>
]]></content>
		</item>
		
	</channel>
</rss>
